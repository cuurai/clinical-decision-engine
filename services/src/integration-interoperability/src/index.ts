/**
 * Service entry point with Fastify server
 *
 * Generated by Service Generator v1.0.0
 * Generator Version: 1.0.0
 * Domain: integration-interoperability
 *
 * ‚ö†Ô∏è  DO NOT EDIT THIS FILE MANUALLY
 * This file is auto-generated. Any manual changes will be overwritten.
 */

import Fastify from "fastify";
import type { FastifyInstance } from "fastify";
import { registerRoutes } from "./routes/index.js";
import { createDependencies } from "./dependencies/integration-interoperability.dependencies.js";
import type { Dependencies } from "./dependencies/integration-interoperability.dependencies.js";

/**
 * Service configuration
 */
export interface ServiceConfig {
  host?: string;
  port?: number;
  logger?: boolean;
}

/**
 * Create and configure Fastify server
 */
export async function createServer(
  deps: Dependencies,
  config: ServiceConfig = {}
): Promise<FastifyInstance> {
  const fastify = Fastify({
    logger: config.logger ?? true,
  });

  // Register routes
  await registerRoutes(fastify, deps);

  // Health check
  fastify.get("/health", async () => {
    return {
      status: "ok",
      service: "integration-interoperability",
      version: "1.0.0",
      timestamp: new Date().toISOString(),
    };
  });

  return fastify;
}

/**
 * Start the service
 */
export async function startService(
  deps: Dependencies,
  config: ServiceConfig = {}
) {
  const host = config.host ?? "0.0.0.0";
  const port = config.port ?? 3000;

  const server = await createServer(deps, config);

  try {
    await server.listen({ host, port });
    console.log(`üöÄ integration-interoperability service listening on http://${host}:${port}`);
  } catch (err) {
    server.log.error(err);
    process.exit(1);
  }

  return server;
}

// Re-export types
export type { Dependencies } from "./dependencies/integration-interoperability.dependencies.js";
export { createDependencies } from "./dependencies/integration-interoperability.dependencies.js";
