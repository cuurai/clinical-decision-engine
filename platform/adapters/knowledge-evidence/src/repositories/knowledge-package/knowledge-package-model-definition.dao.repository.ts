/**
 * DAO adapter for KnowledgePackageModelDefinitionRepository
 *
 * Generated by Adapter Generator v1.0.0
 * Generator Version: 1.0.0
 * Domain: knowledge-evidence
 *
 * ⚠️  DO NOT EDIT THIS FILE MANUALLY
 * This file is auto-generated. Any manual changes will be overwritten.
 */

import type {
  OrgId,
  PaginatedResult,
  PaginationParams,
} from "@cuur-cde/core/_shared";
import type {
  KnowledgePackageModelDefinitionRepository,
} from "@cuur-cde/core/knowledge-evidence";
import type {
  KnowledgePackageModelDefinition,
} from "@cuur-cde/core/knowledge-evidence";
import type { DaoClient } from "@cuur-cde/database";
import { NotFoundError, handleDatabaseError } from "@cuur-cde/core/_shared";

const DEFAULT_LIMIT = 50;

export class DaoKnowledgePackageModelDefinitionRepository implements KnowledgePackageModelDefinitionRepository {

  constructor(
    private readonly dao: DaoClient,
    private readonly tx: TransactionManager
  ) {
  }

  async list(
    orgId: OrgId,
    params?: PaginationParams
  ): Promise<PaginatedResult<KnowledgePackageModelDefinition>> {
    try {
      const limit = params?.limit ?? DEFAULT_LIMIT;

      const records = await this.dao.knowledgePackageModelDefinition.findMany({
        where: {
          orgId,
          deletedAt: null, // Soft delete filter - only return non-deleted records
        },
        orderBy: { createdAt: "desc" },
        take: limit,
        ...(params && 'cursor' in params && params.cursor ? {
          skip: 1,
          cursor: { id: params.cursor },
        } : {}),
      });

      return {
        items: records.map((r: any) => this.toDomain(r)),
        nextCursor: records.length === limit
          ? records[records.length - 1]?.id
          : undefined,
        prevCursor: undefined,
      };
    } catch (error) {
      handleDatabaseError(error);
      throw error;
    }
  }
  async findById(orgId: OrgId, id: string): Promise<KnowledgePackageModelDefinition | null> {
    try {
      const record = await this.dao.knowledgePackageModelDefinition.findFirst({
        where: {
          orgId,
          id,
          deletedAt: null, // Soft delete filter - only return non-deleted records
        },
      });
      return record ? this.toDomain(record) : null;
    } catch (error) {
      handleDatabaseError(error);
      throw error;
    }
  }
  async get(orgId: OrgId, id: string): Promise<KnowledgePackageModelDefinition | null> {
    const result = await this.findById(orgId, id);
    if (!result) {
      throw new NotFoundError("KnowledgePackageModelDefinition", id);
    }
    return result;
  }
  private toDomain(model: any): KnowledgePackageModelDefinition {
    return {
      ...model,
      createdAt: model.createdAt instanceof Date
        ? model.createdAt
        : new Date(model.createdAt),
      updatedAt: model.updatedAt instanceof Date
        ? model.updatedAt
        : model.updatedAt ? new Date(model.updatedAt) : undefined,
    } as KnowledgePackageModelDefinition;
  }
}
