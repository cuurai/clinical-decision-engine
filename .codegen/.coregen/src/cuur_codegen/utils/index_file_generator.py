"""
Index File Generator - Standardized index.ts file generation
"""

from pathlib import Path
from typing import List, Optional

from cuur_codegen.base.context import GenerationContext
from cuur_codegen.utils.file import write_file


class IndexFileGenerator:
    """Generates standardized index.ts files"""

    @staticmethod
    def generate(
        context: GenerationContext,
        output_dir: Path,
        exports: List[str],
        header: Optional[str] = None,
        filename: str = "index.ts",
    ) -> Path:
        """
        Generate an index.ts file with exports.

        Args:
            context: Generation context
            output_dir: Directory where index file should be created
            exports: List of export statements (e.g., ['export * from "./handler.js";'])
            header: Optional header comment (if None, generates default)
            filename: Name of the index file (default: "index.ts")

        Returns:
            Path to generated index file
        """
        if header is None:
            header = f"""/**
 * Auto-generated index file
 *
 * Generated by {context.domain_name} generator
 *
 * ⚠️  DO NOT EDIT THIS FILE MANUALLY
 * This file is auto-generated. Any manual changes will be overwritten.
 */

"""

        content = f"""{header}{chr(10).join(exports)}
"""
        index_file = output_dir / filename
        write_file(index_file, content)
        return index_file

    @staticmethod
    def generate_with_header(
        context: GenerationContext,
        output_dir: Path,
        exports: List[str],
        description: str,
        generator_name: Optional[str] = None,
        filename: str = "index.ts",
    ) -> Path:
        """
        Generate index file with a custom header.

        Args:
            context: Generation context
            output_dir: Directory where index file should be created
            exports: List of export statements
            description: Description for the header
            generator_name: Optional generator name (uses context if not provided)
            filename: Name of the index file (default: "index.ts")

        Returns:
            Path to generated index file
        """
        from cuur_codegen.base.generator import BaseGenerator

        # Create a temporary generator instance to use generate_header
        # In practice, generators should pass their own header
        class TempGenerator(BaseGenerator):
            @property
            def name(self):
                return generator_name or "Index Generator"

            @property
            def version(self):
                return "1.0.0"

            @property
            def type(self):
                return "index"

            def generate(self, context):
                pass

        temp_gen = TempGenerator()
        header = temp_gen.generate_header(context, description)
        return IndexFileGenerator.generate(context, output_dir, exports, header, filename)

